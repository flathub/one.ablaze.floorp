app-id: one.ablaze.floorp
name: Floorp
runtime: org.freedesktop.Platform
runtime-version: 22.08
sdk: org.freedesktop.Sdk
add-extensions:
  org.freedesktop.Platform.ffmpeg-full:
    directory: lib/ffmpeg
    version: 22.08
    add-ld-path: "."

command: floorp

finish-args:
  - --share=ipc
  - --share=network
  - --env=GTK_PATH=/app/lib/gtkmodules
  - --socket=pulseaudio
  - --socket=wayland
  - --socket=x11
  - --socket=pcsc
  - --socket=cups
  - --persist=.floorp
  - --filesystem=xdg-download
  - --filesystem=xdg-documents
  - --filesystem=xdg-desktop
  - --filesystem=xdg-music
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos
  - --filesystem=/run/.heim_org.h5l.kcm-socket
  - --device=all
  - --talk-name=org.freedesktop.FileManager1
  - --system-talk-name=org.freedesktop.NetworkManager
  - --talk-name=org.a11y.Bus
  - --talk-name=org.gnome.SessionManager
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.gtk.vfs.*
  - --talk-name=org.freedesktop.Notifications
  - --own-name=org.mpris.MediaPlayer2.firefox.*
  - --own-name=org.mozilla.floorp.*

modules:
  - name: floorp
    buildsystem: simple
    build-commands:
      - install -Dm644 one.ablaze.floorp.appdata.xml -t /app/share/metainfo/
      - mv ${FLATPAK_BUILDER_BUILDDIR}/*.tar.xz ${FLATPAK_BUILDER_BUILDDIR}/floorp.tar.xz
      - cd /app/ && tar Jxvf ${FLATPAK_BUILDER_BUILDDIR}/floorp.tar.xz
    sources:
      - type: file
        only-arches: [x86_64]
        url: 'https://s3.typeling1578.dev/flatpak-floorp/flatpak-base-10.16.0-x86_64.tar.xz'
        sha256: 29ccbfcb785d7244adf4582f31f2c0eb2b01b369e334156c4e7257e391573d57
      - type: file
        only-arches: [aarch64]
        url: 'https://s3.typeling1578.dev/flatpak-floorp/flatpak-base-10.16.0-aarch64.tar.xz'
        sha256: b1feba6bf1e38e127ad573a49328e50a430504a9295cf07830615fe05fff52df
      - type: file
        path: one.ablaze.floorp.appdata.xml
